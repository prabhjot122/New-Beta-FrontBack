# üöÄ LawVriksh Complete Deployment Guide

## Overview

Complete production deployment guide for LawVriksh platform on Ubuntu 24.04 with beta user registration functionality.

**Live URLs:**
- **Frontend (Beta Joining)**: `https://lawvriksh.com`
- **Backend API**: `https://lawvriksh.com/api`
- **API Documentation**: `https://lawvriksh.com/api/docs`
- **Admin Panel**: `https://lawvriksh.com/admin/login`

## üéØ One-Command Deployment

```bash
# Complete deployment in one command
chmod +x deploy-production-complete.sh && ./deploy-production-complete.sh
```

This will:
- ‚úÖ Install Docker, Nginx, SSL tools
- ‚úÖ Configure firewall and security
- ‚úÖ Setup project structure at `/opt/lawvriksh`
- ‚úÖ Configure nginx for proper routing
- ‚úÖ Generate secure environment variables

## üìã Step-by-Step Deployment

### Step 1: System Setup
```bash
# Run system setup
./deploy-production-complete.sh
```

### Step 2: Deploy Services
```bash
# Change to deployment directory
cd /opt/lawvriksh

# Deploy all services
chmod +x deploy-services.sh && ./deploy-services.sh
```

### Step 3: Setup SSL Certificate
```bash
# Setup SSL certificate
sudo certbot --nginx -d lawvriksh.com -d www.lawvriksh.com
```

### Step 4: Test Deployment
```bash
# Run comprehensive tests
chmod +x test-deployment.sh && ./test-deployment.sh

# Test complete flows (beta + admin)
chmod +x verify-complete-flow.sh && ./verify-complete-flow.sh

# Test admin flow specifically
chmod +x test-admin-flow.sh && ./test-admin-flow.sh
```

## üåê Beta User Registration Flow

### Frontend (React)
- **Landing Page**: Beta joining form with name + email
- **Component**: `WaitlistPopup.tsx` handles user input
- **Service**: `betaService.ts` manages API calls
- **Validation**: Client-side validation for name and email

### Backend (FastAPI)
- **Endpoint**: `POST /api/beta/signup`
- **Input**: `{"name": "User Name", "email": "user@example.com"}`
- **Process**: Creates user with auto-generated password
- **Response**: Welcome message and user details

### Database
- **Table**: `users` with beta user records
- **Admin User**: Pre-created with credentials from `.env`
- **Auto-generated**: Secure passwords for beta users

## üëë Admin Management Flow

### Admin Authentication
- **Login URL**: `https://lawvriksh.com/admin/login`
- **Credentials**: `sahilsaurav2507@gmail.com` / `Sahil@123`
- **Dashboard**: `https://lawvriksh.com/admin/dashboard`

### Admin Features
- **User Management**: View, search, and manage all users
- **Analytics**: Platform statistics and sharing analytics
- **Bulk Email**: Send targeted email campaigns
- **Dashboard**: Real-time platform metrics
- **Beta Users**: Monitor and manage beta registrations

### Admin API Endpoints
- `POST /api/admin/login` - Admin authentication
- `GET /api/admin/dashboard` - Dashboard metrics
- `GET /api/admin/users` - User management
- `GET /api/admin/analytics` - Platform analytics
- `POST /api/admin/send-bulk-email` - Email campaigns

## üîß Configuration Details

### Nginx Configuration
```nginx
# Frontend - lawvriksh.com
location / {
    proxy_pass http://127.0.0.1:3000;
    # React Router SPA handling
    try_files $uri $uri/ @fallback;
}

# Backend API - lawvriksh.com/api
location /api/ {
    proxy_pass http://127.0.0.1:8000/;
    # CORS headers for frontend
    add_header Access-Control-Allow-Origin "https://lawvriksh.com" always;
}
```

### Environment Variables
```bash
# Domain Configuration
DOMAIN=lawvriksh.com
FRONTEND_URL=https://lawvriksh.com
API_BASE_URL=https://lawvriksh.com/api

# Admin Configuration
ADMIN_EMAIL=sahilsaurav2507@gmail.com
ADMIN_PASSWORD=Sahil@123

# Database Configuration
DB_NAME=lawvriksh_referral
DB_USER=lawvriksh_user
DB_PASSWORD=<auto-generated>
```

### Docker Services
- **MySQL 8.0**: Database (port 3307, localhost only)
- **Redis 7**: Cache and sessions
- **FastAPI Backend**: API server (port 8000, localhost only)
- **React Frontend**: Web application (port 3000, localhost only)

## üìä API Endpoints

### Beta Registration
- `POST /api/beta/signup` - Register beta user
- `GET /api/beta/stats` - Get beta statistics
- `GET /api/beta/health` - Beta service health

### Authentication
- `POST /api/auth/login` - User login
- `POST /api/auth/logout` - User logout
- `GET /api/auth/me` - Current user info

### System
- `GET /api/health` - Backend health check
- `GET /api/docs` - API documentation

## üîê Security Features

### SSL/HTTPS
- Let's Encrypt SSL certificates
- HTTP to HTTPS redirect
- Security headers (HSTS, CSP, etc.)

### Firewall
- UFW configured for ports 22, 80, 443
- Rate limiting on API endpoints
- CORS properly configured

### Authentication
- bcrypt password hashing
- JWT token authentication
- Admin user with secure credentials

## üß™ Testing

### Automated Tests
```bash
# Run all deployment tests
./test-deployment.sh
```

Tests include:
- ‚úÖ Docker services health
- ‚úÖ Backend API endpoints
- ‚úÖ Frontend accessibility
- ‚úÖ Beta registration functionality
- ‚úÖ Admin user setup
- ‚úÖ Nginx configuration
- ‚úÖ Database connectivity
- ‚úÖ SSL certificate (if configured)

### Manual Testing
1. **Frontend**: Visit `https://lawvriksh.com`
2. **Beta Registration**: Fill out the joining form
3. **API**: Check `https://lawvriksh.com/api/docs`
4. **Admin Login**: Use sahilsaurav2507@gmail.com / Sahil@123

## üõ†Ô∏è Management Commands

### Service Management
```bash
cd /opt/lawvriksh

# View service status
docker-compose ps

# View logs
docker-compose logs -f backend
docker-compose logs -f frontend

# Restart services
docker-compose restart backend
docker-compose restart frontend

# Stop all services
docker-compose down

# Start all services
docker-compose up -d
```

### Admin Management
```bash
# Verify admin setup
docker-compose exec backend python verify_admin.py

# Reset admin user
docker-compose exec backend python setup_admin.py

# Check database
docker-compose exec mysql mysql -u root -p
```

### Nginx Management
```bash
# Test configuration
sudo nginx -t

# Reload configuration
sudo systemctl reload nginx

# View logs
sudo tail -f /var/log/nginx/lawvriksh_access.log
sudo tail -f /var/log/nginx/lawvriksh_error.log
```

## üîÑ Updates and Maintenance

### Update Application
```bash
cd /opt/lawvriksh

# Pull latest code
git pull origin main

# Rebuild and restart
docker-compose down
docker-compose build --no-cache
docker-compose up -d

# Test deployment
./test-deployment.sh
```

### SSL Certificate Renewal
```bash
# Renew certificates (automatic)
sudo certbot renew

# Test renewal
sudo certbot renew --dry-run
```

### Database Backup
```bash
# Create backup
docker-compose exec mysql mysqldump -u root -p${MYSQL_ROOT_PASSWORD} lawvriksh_referral > backup_$(date +%Y%m%d).sql

# Restore backup
docker-compose exec -T mysql mysql -u root -p${MYSQL_ROOT_PASSWORD} lawvriksh_referral < backup_file.sql
```

## üìÅ File Structure

```
/opt/lawvriksh/
‚îú‚îÄ‚îÄ docker-compose.yml          # Services configuration
‚îú‚îÄ‚îÄ .env                        # Environment variables
‚îú‚îÄ‚îÄ nginx-lawvriksh.conf        # Nginx configuration
‚îú‚îÄ‚îÄ lawdata.sql                 # Database schema
‚îú‚îÄ‚îÄ deploy-production-complete.sh # System setup
‚îú‚îÄ‚îÄ deploy-services.sh          # Services deployment
‚îú‚îÄ‚îÄ test-deployment.sh          # Deployment testing
‚îú‚îÄ‚îÄ setup_admin.py              # Admin user setup
‚îú‚îÄ‚îÄ verify_admin.py             # Admin verification
‚îú‚îÄ‚îÄ app/                        # Backend application
‚îÇ   ‚îú‚îÄ‚îÄ api/beta.py            # Beta registration API
‚îÇ   ‚îî‚îÄ‚îÄ main.py                # FastAPI application
‚îú‚îÄ‚îÄ Frontend/                   # React application
‚îÇ   ‚îú‚îÄ‚îÄ src/services/betaService.ts # Beta service
‚îÇ   ‚îî‚îÄ‚îÄ src/components/WaitlistPopup.tsx # Beta form
‚îú‚îÄ‚îÄ logs/                       # Application logs
‚îú‚îÄ‚îÄ cache/                      # Application cache
‚îî‚îÄ‚îÄ uploads/                    # File uploads
```

## üéâ Success Indicators

When deployment is successful:

1. ‚úÖ All Docker containers running
2. ‚úÖ Frontend accessible at `https://lawvriksh.com`
3. ‚úÖ API documentation at `https://lawvriksh.com/api/docs`
4. ‚úÖ Beta registration form working
5. ‚úÖ Admin login functional
6. ‚úÖ SSL certificate installed
7. ‚úÖ All tests passing

## üìû Troubleshooting

### Common Issues

**Services not starting:**
```bash
docker-compose logs -f
docker-compose down && docker-compose up -d
```

**Nginx errors:**
```bash
sudo nginx -t
sudo systemctl status nginx
```

**SSL issues:**
```bash
sudo certbot certificates
sudo certbot renew --dry-run
```

**Beta registration not working:**
```bash
curl -X POST https://lawvriksh.com/api/beta/signup \
  -H "Content-Type: application/json" \
  -d '{"name":"Test User","email":"test@example.com"}'
```

---

**Ready to deploy?** Run: `chmod +x deploy-production-complete.sh && ./deploy-production-complete.sh`
